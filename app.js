"use strict";(()=>{var k=1e3/20,y=class extends HTMLElement{intervalId=null;item;size=64;constructor(){super()}async connectedCallback(){let e=this.attachShadow({mode:"open"}),t=this.item;if(!t||!t.animation)throw new Error("animated item is required");let n=document.createElement("canvas"),o=t.image.width,r=t.animation;n.width=o,n.height=o,n.style.imageRendering="pixelated",n.style.width=`${this.size}px`,n.style.height=`${this.size}px`;let i=n.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("No canvas context");i.imageSmoothingEnabled=!1;let s=0,c=0,m=C(t.image),u=o**2*4;this.intervalId=setInterval(()=>{c++>=r.frames[s].frameTime&&(c=0,s=(s+1)%r.frames.length);let l=o*r.frames[s].index;if(i.clearRect(0,0,o,o),i.drawImage(t.image,0,l,o,o,0,0,o,o),!r.interpolate)return;let d=c/r.frames[s].frameTime,p=(s+1)%r.frames.length,h=r.frames[p].index,O=u*h,E=i.getImageData(0,0,o,o);for(let g=0;g<E.data.length;g++)E.data[g]=A(d,E.data[g],m.data[O+g]);i.putImageData(E,0,0,0,0,o,o)},k),e.append(n)}disconnectedCallback(){this.intervalId!=null&&clearInterval(this.intervalId)}};function A(a,e,t){return a*(t-e)+e}function C(a){let e=document.createElement("canvas");e.width=a.width,e.height=a.height;let t=e.getContext("2d");if(!t)throw new Error("No canvas context");return t.imageSmoothingEnabled=!1,t.drawImage(a,0,0),t.getImageData(0,0,a.width,a.height)}var v=class extends HTMLElement{size=64;item;dataSource;loadedItem;constructor(){super()}async connectedCallback(){let e=this.attachShadow({mode:"open"}),t=document.createElement("div");if(t.style.minWidth=`${this.size}px`,t.style.minHeight=`${this.size}px`,e.append(t),!this.item||!this.dataSource)throw new Error("item and data source are required");this.loadedItem=await this.dataSource.loadItem(this.item);let n=this.getElementForItem(this.loadedItem);t.append(n)}getElementForItem(e){if(e.animation){let n=document.createElement("animated-texture");return n.item=e,n.size=this.size,n}let t=document.createElement("div");return t.style.backgroundImage=`url("${e.image.src}")`,t.style.backgroundSize="contain",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="center",t.style.imageRendering="pixelated",t.style.width=`${this.size}px`,t.style.height=`${this.size}px`,t}async downloadItem(){if(!this.loadedItem)return;let e=this.item?.imagePath.split("/").at(-1)??"texture.png",n=await(await fetch(this.loadedItem.image.src)).blob();if(this.downloadBlob(n,e),this.loadedItem.animation){let o=new Blob([this.loadedItem.animation.rawJson],{type:"application/json"});this.downloadBlob(o,`${e}.mcmeta`)}}downloadBlob(e,t){let n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=t,o.click()}};var x=class extends HTMLElement{teardown;text;constructor(){super()}connectedCallback(){let e=this.attachShadow({mode:"open"}),t=this.text??"",n=document.createElement("div");n.addEventListener("mouseenter",r=>{let i=document.createElement("div");i.classList.add("tooltip"),i.innerText=t,this.positionTooltip(i,r),document.body.append(i);let s=c=>{this.positionTooltip(i,c)};document.body.addEventListener("mousemove",s),this.teardown=()=>{document.body.removeEventListener("mousemove",s),i.remove()}}),n.addEventListener("mouseleave",()=>{this.teardown?.()});let o=document.createElement("slot");n.append(o),e.append(n)}positionTooltip(e,t){let{width:n,height:o}=e.getBoundingClientRect(),r=F(window.innerWidth,n,t.clientX),i=F(window.innerHeight,o,t.clientY),s=[!r&&`left: ${t.clientX+10}px;`,r&&`right: ${window.innerWidth-t.clientX+10}px;`,!i&&`top: ${t.clientY+10}px;`,i&&`bottom: ${window.innerHeight-t.clientY+10}px;`].filter(c=>c).join("");e.setAttribute("style",s)}disconnectedCallback(){this.teardown?.()}};function F(a,e,t){return t>=a-e-10-10}function w(){return{subfolders:new Map,items:new Map}}function T(a,e){let t=e.width,n=e.height/t,o=a.animation.frametime??1,r=a.animation.interpolate??!1,i=a.animation.frames;return{interpolate:r,frames:i?B(i,o):N(n,o),rawJson:JSON.stringify(a,null,2)}}function N(a,e){return[...new Array(a)].map((t,n)=>({frameTime:e,index:n}))}function B(a,e){return a.map(t=>typeof t=="number"?{index:t,frameTime:e}:{index:t.index,frameTime:t.time})}var f=class{constructor(e,t,n,o){this.username=e;this.repo=t;this.branch=n;this.root=o}getNavBarClass(){return"github"}addDescriptionToNav(e){let t=document.createElement("div");t.innerText=`${this.username}/${this.repo}`;let n=document.createElement("div");n.innerText="GitHub",e.append(t),e.append(n)}addItemsToMenu(e){let t=document.createElement("div");t.innerText="View on GitHub",t.addEventListener("click",()=>{window.open(`https://github.com/${this.username}/${this.repo}`)}),e.append(t)}async getRootFolder(){let e=`https://api.github.com/repos/${this.username}/${this.repo}/git/trees/${this.branch}?recursive=1`,t=await fetch(e),{tree:n}=await t.json(),o=w(),r=/^(.*)\/(.*)\.png(\.mcmeta)?$/;for(let i of n){let s=i.path.match(r);if(!s)continue;let[,c,m,u]=s;if(!c.startsWith(this.root))continue;let l=this.findOrCreateSubfolder(o,c),d=u!=null;(!l.items.has(m)||d)&&l.items.set(m,{imagePath:`${c}/${m}.png`,mcMetaPath:d?`${c}/${m}.png.mcmeta`:void 0})}return o}async loadItem(e){let t=await this.loadImage(e.imagePath),n=await this.loadMcMeta(e.mcMetaPath,t);return{image:t,animation:n}}findOrCreateSubfolder(e,t){let n=t.split("/"),o=e;for(let r of n)o.subfolders.has(r)||o.subfolders.set(r,w()),o=o.subfolders.get(r);return o}getGithubUserContentPath(e){return`https://raw.githubusercontent.com/${this.username}/${this.repo}/${this.branch}/${e}`}loadImage(e){return new Promise(t=>{let n=new Image;n.src=this.getGithubUserContentPath(e),n.crossOrigin="anonymous",n.addEventListener("load",()=>{t(n)})})}async loadMcMeta(e,t){if(e)try{let o=await(await fetch(this.getGithubUserContentPath(e))).json();return T(o,t)}catch(n){console.error(`Couldn't load ${e}:`,n)}}};function L(a,e,t){let n=document.createElement("div");n.classList.add("overlay");let o=document.createElement("div");o.classList.add("modal");let r=document.createElement("texture-loader");r.size=Math.min(window.innerHeight,window.innerWidth)-120,r.dataSource=a,r.item=e;let i=document.createElement("div");i.classList.add("saveButton"),i.innerText="Download",i.addEventListener("click",async c=>{c.stopPropagation(),r.downloadItem()});let s=document.createElement("div");s.classList.add("modalHeader"),s.append(document.createTextNode(t)),s.append(i),o.append(s),o.append(r),n.addEventListener("click",M),o.addEventListener("click",M),document.body.append(n),document.body.append(o)}function S(){document.body.addEventListener("keydown",a=>{a.key==="Escape"&&(a.preventDefault(),M())})}function M(){document.querySelector(".overlay")?.remove(),document.querySelector(".modal")?.remove()}async function b(a){R(a),_(a),z(a),q(),await U(a)}function R(a){document.querySelector("nav").setAttribute("class",a.getNavBarClass())}function _(a){let e=document.querySelector(".dataSource");e.innerHTML="",a.addDescriptionToNav(e)}function z(a){let e=document.querySelector("#dataSourceMenuExtraItems");if(e.innerHTML="",a.addItemsToMenu?.(e),e.childNodes.length>0){let t=document.createElement("div");t.classList.add("divider"),e.append(t)}}function q(){let a=document.querySelector("#search");a.value=""}async function U(a){let e=await a.getRootFolder(),t=D(e),n=document.createDocumentFragment();for(let r of t){let i=r.name.toLowerCase().trim(),s=[...r.items.entries()].sort((c,m)=>c[0].localeCompare(m[0]));for(let[c,m]of s){let u=c.toLowerCase().trim(),l=`${r.name}/${c}`,d=document.createElement("tool-tip");d.text=l,d.setAttribute("data-searchable-name",`${i}/${u}`);let p=document.createElement("texture-loader");p.dataSource=a,p.item=m,d.addEventListener("click",h=>{if(h.ctrlKey||h.metaKey){p.downloadItem();return}L(a,m,l)}),d.addEventListener("contextmenu",h=>{h.preventDefault(),L(a,m,l)}),d.append(p),n.append(d)}}let o=document.querySelector("#textures");o.innerHTML="",o.append(n)}function D(a){let e=[];for(let[t,n]of a.subfolders){let o=D(n);e.push(...o),e.push({name:t,items:n.items})}return e}async function P(){let a=window.location.hash.split("/");a[0]==="#github"&&a[1]&&a[2]&&a[3]&&await b(new f(a[1],a[2],a[3],""))}function $(){let a=document.querySelector("#search");a.addEventListener("input",()=>{let e=a.value.toLowerCase();document.querySelectorAll("[data-searchable-name]").forEach(n=>{if(!(n instanceof HTMLElement))return;let r=n.getAttribute("data-searchable-name")?.toLowerCase()?.includes(e);n.style.display=r?"block":"none"})}),document.addEventListener("keydown",e=>{(e.key==="/"||(e.metaKey||e.ctrlKey)&&e.key==="f")&&(e.preventDefault(),a.focus())})}var I=class{constructor(e){this.directory=e}getNavBarClass(){return"local"}addDescriptionToNav(e){let t=document.createElement("div");t.innerText=this.directory.name;let n=document.createElement("div");n.innerText="Local",e.append(t),e.append(n)}async getRootFolder(){return this.loadFoldersRecursively(this.directory,"")}async loadItem(e){let{imageHandle:t,mcMetaHandle:n}=await this.findImageAndMcMeta(e),o=await this.loadImage(t),r=await this.loadMcMeta(n,e.mcMetaPath,o);return{image:o,animation:r}}async loadFoldersRecursively(e,t){let n=w(),o=/(.*)\.png(\.mcmeta)?/;for await(let[r,i]of e.entries()){if(i.kind==="directory"){let d=await this.loadFoldersRecursively(i,`${t}/${r}`);n.subfolders.set(r,d);continue}let s=r.match(o);if(!s)continue;let[,c,m]=s,u=m!=null;(!n.items.has(r)||u)&&n.items.set(c,{imagePath:`${t}/${c}.png`,mcMetaPath:u?`${t}/${c}.png.mcmeta`:void 0})}return n}async findImageAndMcMeta(e){let t=e.imagePath.slice(1).split("/"),n=this.directory;for(let s of t.slice(0,-1))n=await n.getDirectoryHandle(s);let o=t.at(-1);if(!o)throw new Error("Couldn't find item");let r=await n.getFileHandle(o),i;return e.mcMetaPath&&(i=await n.getFileHandle(`${o}.mcmeta`)),{imageHandle:r,mcMetaHandle:i}}async loadImage(e){return new Promise(async t=>{let n=await e.getFile(),o=new FileReader;o.addEventListener("load",()=>{let r=new Image;r.src=o.result,t(r)}),o.readAsDataURL(n)})}async loadMcMeta(e,t,n){if(!e)return;let o;try{o=await(await e.getFile()).text();let i=JSON.parse(o);return T(i,n)}catch(r){console.error(`Couldn't load ${t}:`,r,o)}}};function H(){let a=document.querySelector("#dataSourceMenuOpenItems"),e=document.createElement("div");e.addEventListener("click",G),e.innerText="Open from GitHub";let t=document.createElement("div");t.addEventListener("click",X),t.innerText="Open from your computer",a.append(e),a.append(t)}async function G(){let a=prompt("Enter the URL to a GitHub repo, and we'll find the textures in it:");if(!a)return;let e=a.match(/^(https?:\/\/)?github\.com\/([^\/]+)\/([^\/]+)/);if(!e)return;let[,,t,n]=e,o=`https://api.github.com/repos/${t}/${n}`,r=await fetch(o),{default_branch:i}=await r.json();window.location.hash=`github/${t}/${n}/${i}`,b(new f(t,n,i,""))}async function X(){if(!window.showDirectoryPicker){alert("Your browser does not support selecting directories. Try Chrome.");return}let a=await window.showDirectoryPicker();window.location.hash="",b(new I(a))}window.addEventListener("load",async()=>{H(),$(),S(),await P()});window.customElements.define("animated-texture",y);window.customElements.define("texture-loader",v);window.customElements.define("tool-tip",x);})();
